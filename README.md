##### Language： English | [中文](README_CN.md)

# iBatis Upgrade Conversion Tool User's Guide

This tool is used to convert iBatis sqlmap xml configuration file to Mybatis mapper xml configuration file

## Features

- This tool sorts through the corresponding dtd files of ibatis and mybatis configuration files to find out the syntax of all the tags that need to be converted
- Analyze and extract the source code of a number of projects that use the ibatis framework, and sort out common scenarios and complex statement examples of ibatis.
- For individual tag conversion logic, write a large number of unit tests for coverage (100% unit test coverage for conversion logic, 91% overall unit test coverage)
- Write integration tests based on complex configuration fragments collected from the actual project source code and build integration test projects to ensure that the converted mybatis configuration files execute with the same data as the original ibatis implementation
- Automatic conversion of ibatis tags that can be converted, and alerts for situations where conversion is not possible or is known to be risky, prompting the user for manual processing
- Support CDATA tag
- For some unusual syntaxes such as cacheModel, flushInterval, etc. are not handled, such unusual syntaxes will form errors in mybatis dtd checksum, which can be handled manually by the user according to the error message. See subsequent sections for syntax support details
- <font color=red>Please make sure to test the conversion results for full coverage</font>



## Usage

- This tool is compiled with JDK 1.8, please make sure that JDK 1.8 is installed in the runtime environment.

- Get the tools jar file ibatisUpgradeTools.jar

- Execute command in the jar file directory

  ```shell
  java -jar ibatisUpgradeTools.jar c:\source c:\dest
  ```

- This command will convert all the corresponding ibatis configuration files in the source directory of the c drive, and the converted files will be generated in the dest directory of the c drive according to the original directory structure

- The log messages generated by the generation process will be located in the result.log file in the same directory where the command was executed

## Syntax Support List

### sqlMap

- **Is supported:** Yes
- **Conversion Logic：** Convert to mapper tag

|   属性    | Is Supported |    Description    |
| :-------: | :---------: | :--------: |
| xmlns:fo  |    Yes     | Same as original value |
| namespace |    Yes     | Same as original value |

### parameterMap

- **Is supported:** Yes
- **Conversion Logic:** No change in tag, conversion attributes

| Attribute  | Is Supported |         Description          |
| :---: | :---------: | :-------------------: |
|  id   |    Yes     |      Same as original value       |
| class |    Yes     | 转换为type,Same as original value |

### parameter

- **Is supported:** Yes
- **Conversion Logic：** No change in tag, conversion attributes

|     Attribute     | Is Supported |       Description        |
| :----------: | :---------: | :---------------: |
|   property   |    Yes     |    Same as original value     |
|   javaType   |    Yes     |    Same as original value     |
|   jdbcType   |    Yes     |    Same as original value     |
|   typeName   |   No    | DTD errror, need manual process |
|  nullValue   |   No    | DTD errror, need manual process |
|     mode     |    Yes     |    Same as original value     |
| typeHandler  |    Yes     |    Same as original value     |
|  resultMap   |    Yes     |    Same as original value     |
| numericScale |   No    | DTD errror, need manual process |

### resultMap

- **Is supported:** Yes
- **Conversion Logic：** No change in tag, conversion attributes
- **Caution：**
  -  As mybatis will enable autoMapping by default, this logic may lead to inconsistent behavior before and after conversion. So after conversion, autoMapping is added by default to falseAttribute
  - groupBy has a de-duplication feature in ibatis, while mybatis does not have this logic, so there may be a problem when the sub-tag no select/resultMap appears. The conversion process will be warned

|  属性   | Is Supported |          Description          |
| :-----: | :---------: | :--------------------: |
|   id    |    Yes     |       Same as original value       |
|  class  |    Yes     | 转换为type,Same as original value  |
| extends |    Yes     |       Same as original value       |
| xmlName |   No    |   DTD errror, need manual process    |
| groupBy |    Yes     | Add id node, delete original Attribute |

### result

- **Is supported:** Yes

|     Attribute      | Is Supported |          Description          |
| :-----------: | :---------: | :--------------------: |
|   property    |    Yes     |       Same as original value       |
|   javaType    |    Yes     |       Same as original value       |
|    column     |    Yes     |       Same as original value       |
|  colunmIndex  |   No    |   DTD errror, need manual process    |
|   jdbcType    |    Yes     |       Same as original value       |
|   nullValue   |   No    |   DTD errror, need manual process    |
| notNullColumn |   No    |   DTD errror, need manual process    |
|    select     |    Yes     | Convert to collection |
|   resultMap   |    Yes     | Convert to collection |
|  typeHandler  |    Yes     |       Same as original value       |

### discriminator

- **Is supported:** No
- **Conversion Logic：** Manual process

### subMap

- **Is supported:** No
- **Conversion Logic：** Manual process

### cacheModel

- **Is supported:** No
- **Conversion Logic：** Manual process

### flushInterval

- **Is supported:** No
- **Conversion Logic：** Manual process

### flushOnExecute

- **Is supported:** No
- **Conversion Logic：** Manual process

### property

- **Is supported:** Yes
- **Conversion Logic：**  No Change

| Attribute  | Is Supported |    Description    |
| :---: | :---------: | :--------: |
| name  |    Yes     | Same as original value |
| value |    Yes     | Same as original value |

### typeAlias

- **Is supported:** Yes
- **Conversion Logic：**  Deleted, extracted and printed to log file

| Attribute  | Is Supported |    Description    |
| :---: | :---------: | :--------: |
| alias |    Yes     | Same as original value |
| type  |    Yes     | Same as original value |

### sql

- **Is supported:** Yes
- **Conversion Logic：**  No Change

| Attribute | Is Supported |    Description    |
| :--: | :---------: | :--------: |
|  id  |    Yes     | Same as original value |

### include

- **Is supported:** Yes
- **Conversion Logic：**  No Change

| Attribute  | Is Supported |    Description    |
| :---: | :---------: | :--------: |
| refid |    Yes     | Same as original value |

### statement

- **Is supported:** Yes
- **Conversion Logic：** If there is a resultClass attribute, it is converted to a select tag, otherwise it is converted to an update tag

|      Attribute      | Is Supported |              Description               |
| :------------: | :---------: | :-----------------------------: |
|       id       |    Yes     |           Same as original value            |
|  parameterMap  |    Yes     |           Same as original value            |
| parameterClass |    Yes     | Convert to parameterType，Same as original value |
|   resultMap    |    Yes     |           Same as original value            |
|  resultClass   |    Yes     |  Convert to resultType, Same as original value   |
|   cacheModel   |   No    |        DTD errror, need manual process        |
| resultSetType  |    Yes     |           Same as original value            |
|   fetchSize    |    Yes     |           Same as original value            |
| xmlResultName  |   No    |        DTD errror, need manual process        |
|  remapResults  |    Yes     |              Removed               |
|    timeout     |    Yes     |           Same as original value            |

### select

- **Is supported:** Yes
- **Conversion Logic：** No change in tag, conversion attributes

|      Attribute      | Is Supported |               Description               |
| :------------: | :---------: |:---------------------------------------:|
|       id       |    Yes     |         Same as original value          |
|  parameterMap  |    Yes     |         Same as original value          |
| parameterClass |    Yes     | Convert to parameterType，Same as original value |
|   resultMap    |    Yes     |         Same as original value          |
|  resultClass   |    Yes     |  Convert to resultType, Same as original value  |
|   cacheModel   |   No    |     DTD errror, need manual process     |
| resultSetType  |    Yes     |         Same as original value          |
|   fetchSize    |    Yes     |         Same as original value          |
| xmlResultName  |   No    |     DTD errror, need manual process     |
|  remapResults  |    Yes     |                 Removed                 |
|    timeout     |    Yes     |         Same as original value          |

### insert

- **Is supported:** Yes
- **Conversion Logic：** No change in tag, conversion attributes

|      Attribute      | Is Supported |              Description               |
| :------------: | :---------: | :-----------------------------: |
|       id       |    Yes     |           Same as original value            |
|  parameterMap  |    Yes     |           Same as original value            |
| parameterClass |    Yes     | Convert to parameterType，Same as original value |
|    timeout     |    Yes     |           Same as original value            |

### selectKey

- **Is supported:** No
- **Conversion Logic：** Manual process

### update

- **Is supported:** Yes
- **Conversion Logic：** No change in tag, conversion attributes

|      Attribute      | Is Supported |              Description               |
| :------------: | :---------: | :-----------------------------: |
|       id       |    Yes     |           Same as original value            |
|  parameterMap  |    Yes     |           Same as original value            |
| parameterClass |    Yes     | Convert to parameterType，Same as original value |
|    timeout     |    Yes     |           Same as original value            |

### delete

- **Is supported:** Yes
- **Conversion Logic：** No change in tag, conversion attributes

|      Attribute      | Is Supported |              Description               |
| :------------: | :---------: | :-----------------------------: |
|       id       |    Yes     |           Same as original value            |
|  parameterMap  |    Yes     |           Same as original value            |
| parameterClass |    Yes     | Convert to parameterType，Same as original value |
|    timeout     |    Yes     |           Same as original value            |

### procedure

- **Is supported:** Yes
- **Conversion Logic：** Convert to update tag, add statement property to CALLABLE

|      Attribute      | Is Supported |              Description               |
| :------------: | :---------: | :-----------------------------: |
|       id       |    Yes     |           Same as original value            |
|  parameterMap  |    Yes     |           Same as original value            |
| parameterClass |    Yes     | Convert to parameterType，Same as original value |
|   resultMap    |    Yes     |           Same as original value            |
|  resultClass   |    Yes     |  Convert to resultType, Same as original value   |
|   cacheModel   |   No    |        DTD errror, need manual process        |
|   fetchSize    |    Yes     |           Same as original value            |
| xmlResultName  |   No    |        DTD errror, need manual process        |
|  remapResults  |    Yes     |              Removed               |
|    timeout     |    Yes     |           Same as original value            |

### dynamic

- **Is supported:** Yes
- **Conversion Logic：** Convert to trim
- **Caution：**
  - The prepend attribute of all dynamic tag direct inline tags will be collected and added to the prefixOverrides attribute separated by '|'

|  Attribute   | Is Supported |                                      Description                                      |
| :-----: | :---------: |:-------------------------------------------------------------------------------------:|
| prepend |    Yes     |  Combined with the value of the open attribute, as the value of the new tag prepend   |
|  class  |    Yes     | Combined with the value of the prepend attribute, as the value of the new tag prepend |
| extends |    Yes     |                                   Convert to suffix                                   |

### isNotNull

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：** If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|                    |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |

### isNull

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：** If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |

### isNotPropertyAvailable

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - If the removeFirstPrepend property is present, please perform further tests
  - The prerequisite for conversion is that the input parameter is of type map. If the input parameter is a normal pojo, an error will occur after conversion. Please pay attention to check

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |

### isPropertyAvailable

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - If the removeFirstPrepend property is present, please perform further tests
  - The prerequisite for conversion is that the input parameter is of type map. If the input parameter is a normal pojo, an error will occur after conversion. Please pay attention to check

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |

### isEqual

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - To prevent the char test of mybatis test from failing, test uses a toString , which can be adjusted according to the actual situation
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |
|  compareProperty   |    Yes     |              Take the value and add it to the test property expression               |
|    compareValue    |    Yes     |              Take the value and add it to the test property expression               |

### isNotEqual

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - To prevent the char test of mybatis test from failing, test uses a toString , which can be adjusted according to the actual situation
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |
|  compareProperty   |    Yes     |              Take the value and add it to the test property expression               |
|    compareValue    |    Yes     |              Take the value and add it to the test property expression               |

### isGreaterThan

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |
|  compareProperty   |    Yes     |              Take the value and add it to the test property expression               |
|    compareValue    |    Yes     |              Take the value and add it to the test property expression               |

### isGreaterEqual

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |
|  compareProperty   |    Yes     |              Take the value and add it to the test property expression               |
|    compareValue    |    Yes     |              Take the value and add it to the test property expression               |

### isLessThan

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |
|  compareProperty   |    Yes     |              Take the value and add it to the test property expression               |
|    compareValue    |    Yes     |              Take the value and add it to the test property expression               |

### isLessEqual

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |
|  compareProperty   |    Yes     |              Take the value and add it to the test property expression               |
|    compareValue    |    Yes     |              Take the value and add it to the test property expression               |

### isEmpty

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - will first determine whether the incoming parameter is null, and then determine whether the parameter is converted to a string and takes the value of the empty string
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |

### isNotEmpty

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - will first determine whether the incoming parameter is null, and then determine whether the parameter is converted to a string and takes the value of the empty string
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
|      property      |    Yes     |              Take the value and add it to the test property expression               |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |

### isParameterPresent

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - Determine if _parameter is empty
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                                     Description                                      |
| :----------------: | :---------: |:------------------------------------------------------------------------------------:|
|      prepend       |    Yes     |       Combined with the open attribute value, add in front of  the inline text       |
|        open        |    Yes     | Combined with the value of the prepend attribute, added in front of the inline text  |
|       close        |    Yes     |                            Add to the end of inline text                             |
| removeFirstPrepend |    Yes     |        Add inline trim child node，<font color=red>Test is recommended</font>         |

### isNotParameterPresent

- **Is supported:** Yes
- **Conversion Logic：** Convert to if
- **Caution：**
  - Determine if _parameter is empty
  - If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                          Description                           |
| :----------------: | :---------: | :-----------------------------------------------------: |
|      prepend       |    Yes     |          Combined with the open attribute value, add in front of  the inline text           |
|        open        |    Yes     |         Combined with the value of the prepend attribute, added in front of the inline text         |
|       close        |    Yes     |                   Add to the end of inline text                    |
| removeFirstPrepend |    Yes     | Add inline trim child node，<font color=red>Test is recommended</font> |

### iterate

- **Is supported:** Yes
- **Conversion Logic：** Convert to foreach
- **Caution：**
  - This tag conversion logic is complex, if there are multiple layers of nested iterate tags, please be sure to conduct further testing
  - There may be a problem with the removeFirstPrepend conversion，If the removeFirstPrepend property is present, please perform further tests

|        Attribute        | Is Supported |                                      Description                                       |
| :----------------: | :---------: |:--------------------------------------------------------------------------------------:|
|      prepend       |    Yes     |        Combined with the open attribute value, add in front of  the inline text        |
|        open        |    Yes     |  Combined with the value of the prepend attribute, added in front of the inline text   |
|       close        |    Yes     |                             Add to the end of inline text                              |
| removeFirstPrepend |    Yes     |            Add trim node outside，<font color=red>Test is recommended</font>            |
|      property      |    Yes     |                   Convert to collection property, add item property                    |
|    conjunction     |    Yes     |               Convert to a separator property, taking the original value               |

